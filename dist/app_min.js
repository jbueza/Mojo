(function(f,d){var e=function(){};e.controllers={};e.applications={};e.options={};e._loaded=[];e.resolve=function(a){if(!e._namespace._provided[a]){return a.replace(/\./gi,"/");}return false;};e._namespace=function(i){var c=(""+i).split(/\./),a=c.length,b=[],l=window||{};if(!e._namespace._provided){e._namespace._provided={};}if(e._namespace._provided[i]==i){throw new Error(i+" has already been defined.");}for(var m=0;m<a;m+=1){var n=c[m];if(!l[n]){b[m]=n;l[n]=function(){};e._namespace._provided[b.join(".")]=l[n];}l=l[n];}return l;};e.query=function(){return jQuery.apply(this,arguments);};e.queryFirst=function(){return e.query.apply(this,arguments)[0];};e.require=function(n,b){if("undefined"==typeof n||!n){throw new Error("'dependencies' is required");}if("undefined"==typeof b||!b){throw new Error("'callback' is required");}if(!$.isArray(n)){n=[n];}var c=n.length,a,o=0;var r=e.controllers;for(var p=0;p<c;p++){var i=n[p];a=e.options.baseSrc+e.resolve(i)+".js";e._loaded.push(i);$.getScript(a,function(){o++;});}var q=setInterval(function(){if(b&&o==c){clearInterval(q);b.call(this);}},25);};e.fetch=function(b,a){$.getScript(b,function(){if(a){a.apply(this,arguments);}});};e.define=function(a,b){if("undefined"==typeof a||!a){throw new Error("'id' is required");}if("undefined"==typeof b||!b){throw new Error(a+" missing factory implementation");}if("function"==typeof b){b=b.call(this);}if(typeof a=="string"){if(e.controllers.hasOwnProperty(a)){throw new Error(a+" controller already exists");return false;}e._namespace(a);e._loaded[a]=b;e.controllers[a]=b;}};e.create=function(a,b){if(typeof b=="undefined"){b={};if(!b.baseSrc){b.baseSrc="js/";}}b.appName=a;$.extend(this.options,b);return new Application();};window.MOJO=e;})(window,document);MOJO.define("Request",function(){function b(f,a,g,h){if("undefined"==typeof f||!f){throw new Error("'paramsObj' is required");}if("undefined"==typeof a||!a){throw new Error("'callerObj' is required");}if("undefined"==typeof g||!g){throw new Error("'eventObj' is required");}if("undefined"==typeof h||!h){throw new Error("'controllerObj' is required");}this.paramsObj=f;this.callerObj=a;this.eventObj=g;this.controllerObj=h;}b.prototype.getController=function(){return this.controllerObj;};b.prototype.getContextElement=function(){return this.getController().getContextElement();};b.prototype.getCaller=function(){return this.callerObj;};b.prototype.getEvent=function(){return this.eventObj;};window.Request=b;return b;});MOJO.define("Controller",function(){function b(){this.contextElement=null;this.controllerClass=null;this.events;}b.prototype.onInit=function(){};b.prototype.onParamChange=function(){};b.prototype.params={};b.prototype.initialize=function(h,g,f){var a=this;a.contextElement=h;a.controllerClass=g;if("undefined"!=typeof f||!f){a.params=f;}$(a.events).each(function(e,m){var o=$(document),c=m[0],p=m[1],n=m[2],d=m[3];if(c=="context"){o=$(h);}$(o).delegate(p,n,function(i){var j=new Request($(this).data()||{},this,i,a);if(typeof a.before!="undefined"&&typeof a.before[d]!="undefined"){a.before[d].call(a,j);}a.methods[d].call(MOJO.controllers[g],j);if(typeof a.after!="undefined"&&typeof a.after[d]!="undefined"){a.after[d].call(a,j);}});});a.onInit();};b.prototype.getContextElement=function(){if(!this.contextElement){return null;}return this.contextElement;};b.prototype.param=function(a,d){if("undefined"==typeof this.params){this.params={};}if(arguments.length>1){this.params[a]=d;this.onParamChange();return this;}else{return this.params[a];}};window.Controller=b;return b;});MOJO.define("Application",function(){function k(){if(!this.options){this.options={};}var b=this,a=b.options;a.locale="en_CA";a.plugins=[];a.pluginSrc="js/lib/plugins/";a.pluginsAsync=true;a.environment="dev";a.selector=jQuery||(function(){throw new Error("Unable to find jQuery");})();b.siteMap=[];}k.prototype.onComplete=function(){};k.prototype.configure=function(c,a){if(arguments.length>1){this.options[c]=a;if(this.options.environment=="dev"){try{console.info("Configure: ",c," -> ",a);}catch(b){}}return this;}else{return this.options[c];}};k.prototype.map=function l(d,a){var c=this;var b=$(d);b.each(function(f,e){c.siteMap.push({context:e,init:a});});if("function"==typeof a){a.call(this,c);}return this;};k.prototype.setupController=function g(e,f,a){if("undefined"==typeof e||!e){throw new Error("'context' is a required parameter");}if("undefined"==typeof f||!f){throw new Error("'controller' is a required parameter");}var c=$(e);var d=MOJO.controllers[f];var b=new Controller(),d=$.extend(d,d.methods),d=$.extend(d,b);MOJO.controllers[f]=d;if(typeof d=="undefined"){throw new Error("Undefined Controller @ ",f);}d.initialize(e,f,a);if("undefined"==typeof e.mojoControllers){e.mojoControllers=[];}e.mojoControllers.push({controller:d});if(typeof d.after!="undefined"&&d.after.Start!="undefined"){d.after.Start.call(d,null);}};k.prototype.disconnectController=function j(a,b){if("undefined"==typeof a||!a){throw new Error("'node' is a required parameter");}if("undefined"==typeof b||!b){throw new Error("'controller' is a required parameter");}$(a).unbind().undelegate();if("undefined"!=typeof $(a)[0].mojoControllers){delete $(a)[0].mojoControllers;}return this;};k.prototype.disconnectControllers=function i(a){var b=this;$(this.siteMap).each(function(d,c){$(c.context).unbind().undelegate();if("undefined"!=typeof $(c.context)[0].mojoControllers){delete $(c.context)[0].mojoControllers;}});if("undefined"!=typeof a&&"function"==typeof a){a.apply(this);}};k.prototype.connectControllers=function h(){var b=this,a=[];$(b.siteMap).each(function(d,e){var c;if("function"==typeof e.init){c=e.init.call(this);}else{c=e.init;}$(c).each(function(n,f){if(!MOJO.controllers.hasOwnProperty(f.controller)){a.push(f.controller);}else{MOJO._loaded[f.controller]=f.controller;}});});if(b.options.environment=="dev"){MOJO.require($.unique(a),function(){$(b.siteMap).each(function(e,f){if(b.options.environment=="dev"){try{console.log("Mapping ["+e+"]: ",f.context);}catch(c){}}var d=("function"==typeof f.init)?f.init.call(this):f.init;$(d).each(function(o,p){b.setupController(f.context,p.controller,p.params);});});});}};k.prototype.getPlugins=function(a){var c=this,b=c.options.pluginSrc;if(!c.options.pluginsAsync){$.ajaxSetup({async:false});}$(c.options.plugins).each(function(e,d){MOJO.fetch(b+d+".js");});if(!c.options.pluginsAsync){$.ajaxSetup({async:true});}if("undefined"!=typeof a&&"function"==typeof a){a.call(c);}};k.prototype.start=function(){var a=this;$(document).ready(function(){a.disconnectControllers(function(){if(a.options.plugins.length){a.getPlugins(function(){a.connectControllers();});}else{a.connectControllers();}a.onComplete();});});};k.prototype.remap=function(){var a=this;a.disconnectControllers(function(){a.connectControllers();a.onComplete();});};("undefined"==typeof window)?process.Application=k:window.Application=k;window.Application=k;return k;});MOJO.define("Service",function(){function b(h,g,a){if(typeof a=="undefined"){a={};}var f={method:a.method||function(){var c="get";if(h.match(/^get/i)){c="get";}else{if(h.match(/^add|del|update/i)){c="post";}}return c;}(),template:false};this.name=h;this.uri=g;this.options=$.extend({},f,a);}b.prototype.invoke=function(l,j,n){var a=this;var o=this.getOptions()||{},k=o.method,m=a.getURI(),p=o.responseType||"JSON";if(o.template){m=a.parse(m,l);if(k=="get"){l=null;}}$.ajaxSetup({dataTypeString:p,type:k,async:o.async||"true",cache:o.cache||"false",contentType:o.contentType||"application/json; charset=utf-8"});$.ajax({url:m,data:l}).success(function(c){if(p=="JSON"&&this.contentType.match(/javascript/g)){c=$.parseJSON(c);}if("undefined"!=typeof j){if(typeof j=="function"){j.call(n,null,c);}else{n[j](null,c);}}}).error(function(){if("undefined"!=typeof j){j.call(n,"Unable to execute XHR",arguments);}});};b.prototype.getName=function(){return this.name;};b.prototype.getURI=function(){return this.uri;};b.prototype.getOptions=function(){return this.options;};b.prototype.option=function(){if(arguments.length>1){this.options[arguments[0]]=arguments[1];return this;}else{return this.options[arguments[0]];}};b.prototype.parse=function(a,d){$.each(d,function(f,c){a=a.split("{"+f+"}").join(c);});return a;};window.Service=b;return b;});MOJO.define("ServiceLocator",function(){var b={services:{},addService:function(a){this.services[a.name]=a;return this;},getService:function(a){return this.services[a];},removeService:function(a){delete this.services[a];},removeServices:function(){this.services={};}};window.ServiceLocator=b;return b;});MOJO.define("ExampleApp.LoginController",{events:[["context",".btn-login","click","Login"],["context",".btn-logout","click","Logout"]],methods:{Login:function(b){var a=b.getContextElement();alert("Logged in from "+this.controllerClass);},Logout:function(a){alert("Logged out from "+this.controllerClass);}},after:{Start:function(){}}});MOJO.define("ExampleApp.RegistrationController",{events:[["context",".btn-submit-registration","click","Register"],["dom",".btn-test-outside","click","Register"]],methods:{Register:function(b){var a=b.getContextElement();alert("REGISTER from "+this.controllerClass);}}});MOJO.define("ExampleApp.GalleryController",{events:[],methods:{},after:{Start:function(){$("#mycarousel",this.getContextElement()).jcarousel();}}});MOJO.define("ExampleApp.member.ProfileController",{events:[["context",".btn-save-profile","click","Save"]],methods:{Save:function(b){var a={};$("input[type=text], textarea").each(function(d,c){c=$(c);a[c.attr("name")]=c.val();});ServiceLocator.getService("UpdateProfile").invoke(a,function(c,d){console.log("Success!");$(".success",this.getContextElement()).show("fast");},this);}},after:{Start:function(){var a=this;$.each(this.params,function(b,c){$("input[name='"+b+"']",a.getContextElement()).val(c);});}}});ServiceLocator.addService(new Service("UpdateProfile","data/success.json"));var app=MOJO.create({baseSrc:"js/"});app.configure("appName","ExampleApp").configure("locale","en_US").configure("environment","prod").configure("pluginSrc","js/lib/plugins/").configure("plugins",["jqmodal","jcarousel","pubsub"]).configure("selector",jQuery.sub()).map("#registration-example",function(){return[{controller:"ExampleApp.RegistrationController",params:{user:123,firstName:"Johnson"}}];}).map("#login-example",function(){return[{controller:"ExampleApp.LoginController"}];}).map("#profile-example",function(){return[{controller:"ExampleApp.member.ProfileController",params:{currentCity:"Vancouver",hometown:"Winnipeg"}}];}).map("#gallery-example",function(){return[{controller:"ExampleApp.GalleryController"}];}).start();